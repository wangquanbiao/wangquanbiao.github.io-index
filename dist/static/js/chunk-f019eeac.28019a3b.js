(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f019eeac"],{7568:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"account_comp"},[r("el-row",[r("el-form",{ref:"ruleForm",attrs:{"label-width":"90px",inline:!0,model:e.formInline}},[r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"姓名",prop:"nickName"}},[r("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入"},model:{value:e.formInline.nickName,callback:function(t){e.$set(e.formInline,"nickName",t)},expression:"formInline.nickName"}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"电话号码",prop:"phonenumber"}},[r("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入"},model:{value:e.formInline.phonenumber,callback:function(t){e.$set(e.formInline,"phonenumber",t)},expression:"formInline.phonenumber"}})],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.formInline.status,callback:function(t){e.$set(e.formInline,"status",t)},expression:"formInline.status"}},e._l(e.dict.type.sys_normal_disable,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),r("el-col",{attrs:{span:6}},[r("el-form-item",{attrs:{label:"值班状态：",prop:"dutyStatus"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.formInline.dutyStatus,callback:function(t){e.$set(e.formInline,"dutyStatus",t)},expression:"formInline.dutyStatus"}},e._l(e.optionsJobStatus,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)],1),r("div",{staticStyle:{display:"flex","justify-content":"flex-end","padding-right":"15px"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleQuery(void 0)}}},[e._v("查询")]),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1),r("el-button",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")]),r("el-button",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"primary"},on:{click:e.handleExport}},[e._v("导出")]),r("vxe-grid",{attrs:{"pager-config":e.table.page,border:"",resizable:"","auto-resize":"",height:"700",loading:e.table.loading,columns:e.columns,data:e.table.datas},on:{"page-change":e.handlePageChange},scopedSlots:e._u([{key:"status",fn:function(t){var a=t.row;return[r("el-switch",{attrs:{"active-value":"0","inactive-value":"1"},on:{change:function(t){return e.handleStatusChange(a)}},model:{value:a.status,callback:function(t){e.$set(a,"status",t)},expression:"row.status"}})]}},{key:"dutyStatus",fn:function(t){var a=t.row;return[r("span",{style:{color:"1"==a.dutyStatus?"#41b883":"#c80000"}},[e._v(" "+e._s("1"==a.dutyStatus?"值班中":"休息中")+" ")])]}},{key:"operation",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleUpdate(a)}}},[e._v("修改")]),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDel(a)}}},[e._v("删除")])]}}])}),r("el-dialog",{attrs:{title:e.title,visible:e.open,width:"1200px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"用户姓名",prop:"nickName"}},[r("el-input",{attrs:{placeholder:"请输入用户姓名",maxlength:"30"},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"是否为用户",prop:"status"}},[r("el-select",{staticClass:"width100",attrs:{placeholder:"请选择"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[r("el-option",{attrs:{label:"是",value:"0"}}),r("el-option",{attrs:{label:"否",value:"1"}})],1)],1)],1)],1),r("el-row",{staticStyle:{"padding-bottom":"5px"}},[r("el-col",{attrs:{span:12}},[void 0==e.form.userId?r("el-form-item",{attrs:{label:"用户账号",prop:"userName"}},[r("el-input",{attrs:{placeholder:"请输入用户账号",maxlength:"30"},model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1):e._e()],1),r("el-col",{attrs:{span:12}},[void 0==e.form.userId?r("el-form-item",{attrs:{label:"用户密码",prop:"password"}},[r("el-input",{attrs:{placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e()],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"归属部门",prop:"deptId"}},[r("treeselect",{attrs:{options:e.deptOptions,"show-count":!0,placeholder:"请选择归属部门"},model:{value:e.form.deptId,callback:function(t){e.$set(e.form,"deptId",t)},expression:"form.deptId"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"其他所属部门：",prop:"secondDeptId"}},[r("treeselect",{attrs:{flat:!0,multiple:!0,options:e.deptOptions2,"show-count":!0,placeholder:"请选择其他所属部门"},model:{value:e.form.secondDeptId,callback:function(t){e.$set(e.form,"secondDeptId",t)},expression:"form.secondDeptId"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"手机号码",prop:"phonenumber"}},[r("el-input",{attrs:{placeholder:"请输入手机号码",maxlength:"11"},model:{value:e.form.phonenumber,callback:function(t){e.$set(e.form,"phonenumber",t)},expression:"form.phonenumber"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"角色"}},[r("el-select",{attrs:{multiple:"",placeholder:"请选择角色"},model:{value:e.form.roleIds,callback:function(t){e.$set(e.form,"roleIds",t)},expression:"form.roleIds"}},e._l(e.roleOptions,(function(e){return r("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId,disabled:1==e.status}})})),1)],1)],1)],1),r("el-row",[r("el-form-item",{attrs:{label:"照片",prop:"avatar"}},[r("upload",{attrs:{imgsList:e.imgsList,filesList:e.filesList,objParams:{atmLimit:1}},on:{returnRes:e._returnRes,returnResDel:e._returnResDel},model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}})],1)],1),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),r("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1)],1)},n=[],o=r("5530"),s=(r("a15b"),r("d81d"),r("14d9"),r("a9e3"),r("c0c7")),l=r("2934"),i=r("7ded"),u=r("24e5"),d=r.n(u),c=r("36fa"),m=r("ca17"),p=r.n(m),f=(r("542c"),{dicts:["sys_normal_disable"],components:{upload:c["a"],Treeselect:p.a},props:["deptId"],watch:{deptId:{handler:function(e,t){this.handleQuery(e),this.crow.deptId=e},immediate:!0}},data:function(){return{table:{loading:!0,page:{currentPage:1,pageSize:10,pageSizes:[10,20,50],total:0},datas:[]},columns:[{title:"用户编号",field:"userId",align:"center",width:80},{title:"用户姓名",field:"nickName",align:"center"},{title:"用户账号",field:"userName",align:"center"},{title:"公司名称",field:"companyName",align:"center"},{title:"部门名称",field:"deptName",align:"center"},{title:"电话号码",field:"phonenumber",align:"center"},{title:"状态",slots:{default:"status"},align:"center",width:60},{title:"值班状态",slots:{default:"dutyStatus"},align:"center",width:80},{title:"创建时间",field:"createTime",align:"center"},{title:"操作",slots:{default:"operation"},align:"center"}],isShowAdd:!1,crow:{},formInline:{nickName:void 0,phonenumber:void 0,status:void 0,dutyStatus:void 0},optionsJobStatus:[{label:"值班中",value:"1"},{label:"未值班",value:"0"}],open:!1,form:{},title:"",deptOptions:void 0,deptOptions2:void 0,roleOptions:[],imgsList:[],filesList:[],initPassword:void 0,rules:{userName:[{required:!0,message:"用户账号不能为空",trigger:"blur"},{min:2,max:20,message:"用户账号长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"请选择归属部门",trigger:"change"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\w\s]).{8,}$/,min:5,max:20,message:"密码包括字母大小写（区分大小写）、数字、符号，最少8位数！",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],idCard:[{pattern:/^\d{6}((((((19|20)\d{2})(0[13-9]|1[012])(0[1-9]|[12]\d|30))|(((19|20)\d{2})(0[13578]|1[02])31)|((19|20)\d{2})02(0[1-9]|1\d|2[0-8])|((((19|20)([13579][26]|[2468][048]|0[48]))|(2000))0229))\d{3})|((((\d{2})(0[13-9]|1[012])(0[1-9]|[12]\d|30))|((\d{2})(0[13578]|1[02])31)|((\d{2})02(0[1-9]|1\d|2[0-8]))|(([13579][26]|[2468][048]|0[048])0229))\d{2}))(\d|X|x)$/,message:"请输入正确的身份证号码",trigger:"blur"}]}}},mounted:function(){this.getDeptTree()},methods:{handleExport:function(){var e=Object(o["a"])(Object(o["a"])({},this.formInline),{},{pageNum:this.table.page.currentPage,pageSize:this.table.page.pageSize,deptId:this.deptId});this.download("system/user/export",Object(o["a"])({},e),"账号管理_".concat((new Date).getTime(),".xlsx"))},cancel:function(){this.open=!1,this.reset()},_returnRes:function(e){var t={name:e.fileName,attachId:e.id,fileUrl:e.fileUrl};this.imgsList.push(t)},_returnResDel:function(e){this.imgsList=[]},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(0!=e.imgsList.length&&(e.form.avatar=e.imgsList[0].fileUrl),e.form.avatar||(e.form.avatar="/profile/20240201/8d12fe9a631f46f79d6027c2706a60f8.png"),e.form.secondDeptId=e.form.secondDeptId&&e.form.secondDeptId.length>0?e.form.secondDeptId.map((function(e){return e})).join(","):"",Object(i["c"])().then((function(t){var r=new d.a;r.setPublicKey(t.data),e.form.password=r.encrypt(e.form.password),void 0!=e.form.userId?Object(s["m"])(e.form).then((function(t){e.$modal.msgSuccess("修改成功"),e.open=!1,e.handleQuery()})):Object(s["a"])(e.form).then((function(t){e.$modal.msgSuccess("新增成功"),e.open=!1,e.handleQuery()}))})))}))},getDeptTree:function(){var e=this;Object(s["e"])().then((function(t){e.deptOptions=t.data})),Object(l["u"])(this.$store.getters.userInfo.companyId).then((function(t){e.deptOptions2=t.data}))},resetForm:function(e){var t=this;this.$nextTick((function(){t.$refs[e].resetFields()}))},reset:function(){for(var e in this.filesList=[],this.imgsList=[],this.form={userId:void 0,deptId:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[],idCard:void 0,joinUsTime:void 0,startWorkTime:void 0,politicalStatus:void 0,nativePlace:void 0,jobStatus:void 0,avatar:void 0},this.form)this.form[e]=void 0},handleStatusChange:function(e){var t=this,r="0"===e.status?"启用":"停用";this.$modal.confirm('确认要"'+r+'""'+e.userName+'"用户吗？').then((function(){return Object(s["b"])(e.userId,e.status)})).then((function(){t.$modal.msgSuccess(r+"成功")})).catch((function(){e.status="0"===e.status?"1":"0"}))},handleAdd:function(){var e=this;this.reset(),this.open=!0,this.title="添加用户",Object(s["h"])().then((function(t){e.roleOptions=t.roles,e.form.password=e.initPassword}))},handleDel:function(e){var t=this,r=e.userId;this.$modal.confirm('是否确认删除用户编号为"'+r+'"的数据项？').then((function(){return Object(s["d"])(r)})).then((function(){t.handleQuery(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleUpdate:function(e){var t=this,r=e.userId;Object(s["h"])(r).then((function(e){t.open=!0,t.reset(),t.form=e.data,t.imgsList.push({fileUrl:t.form.avatar}),t.form.secondDeptId=t.form.secondDeptId?t.form.secondDeptId.split(",").map((function(e){return Number(e)})):void 0,t.roleOptions=e.roles,t.$set(t.form,"postIds",e.postIds),t.$set(t.form,"roleIds",e.roleIds),t.title="修改用户",t.form.password=""}))},handlePageChange:function(e){var t=e.currentPage,r=e.pageSize;this.table.page.currentPage=t,this.table.page.pageSize=r,this.handleQuery()},handleQuery:function(e){var t=this;this.table.loading=!0;var r=Object(o["a"])(Object(o["a"])({},this.formInline),{},{pageNum:this.table.page.currentPage,pageSize:this.table.page.pageSize,deptId:e||this.deptId});Object(s["j"])(r).then((function(e){e.rows.map((function(e){e.deptName=e.dept.deptName,e.remark=e.remark||e.dept.remark})),t.table.datas=e.rows,t.table.page.total=e.total,t.table.loading=!1}))}}}),h=f,b=r("2877"),g=Object(b["a"])(h,a,n,!1,null,null,null);t["default"]=g.exports},c0c7:function(e,t,r){"use strict";r.d(t,"j",(function(){return o})),r.d(t,"h",(function(){return s})),r.d(t,"a",(function(){return l})),r.d(t,"m",(function(){return i})),r.d(t,"d",(function(){return u})),r.d(t,"g",(function(){return d})),r.d(t,"k",(function(){return c})),r.d(t,"b",(function(){return m})),r.d(t,"i",(function(){return p})),r.d(t,"n",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"o",(function(){return b})),r.d(t,"p",(function(){return g})),r.d(t,"f",(function(){return v})),r.d(t,"l",(function(){return y})),r.d(t,"e",(function(){return I}));var a=r("b775"),n=r("c38a");function o(e){return Object(a["a"])({url:"/system/user/list",method:"get",params:e})}function s(e){return Object(a["a"])({url:"/system/user/"+Object(n["e"])(e),method:"get"})}function l(e){return Object(a["a"])({url:"/system/user",method:"post",data:e})}function i(e){return Object(a["a"])({url:"/system/user",method:"put",data:e})}function u(e){return Object(a["a"])({url:"/system/user/"+e,method:"delete"})}function d(e){var t=e.pageSize,r=void 0===t?10:t;return Object(a["a"])({url:"system/post/list?pageNum=1&pageSize=".concat(r),method:"get"})}function c(e,t){var r={userId:e,password:t};return Object(a["a"])({url:"/system/user/resetPwd",method:"put",data:r})}function m(e,t){var r={userId:e,status:t};return Object(a["a"])({url:"/system/user/changeStatus",method:"put",data:r})}function p(){return Object(a["a"])({url:"/system/user/profile",method:"get"})}function f(e){return Object(a["a"])({url:"/system/user/profile",method:"put",data:e})}function h(){return Object(a["a"])({url:"/system/user/profile/checkUserPassword",method:"get"})}function b(e,t){var r={oldPassword:e,newPassword:t};return Object(a["a"])({url:"/system/user/profile/updatePwd",method:"put",params:r})}function g(e){return Object(a["a"])({url:"/system/user/profile/avatar",method:"post",data:e})}function v(e){return Object(a["a"])({url:"/system/user/authRole/"+e,method:"get"})}function y(e){return Object(a["a"])({url:"/system/user/authRole",method:"put",params:e})}function I(e){return Object(a["a"])({url:"/system/user/deptTree",method:"get",params:e})}}}]);