(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e38d1780"],{"0ddc":function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return o}));var i=a("b775");function r(e){return Object(i["a"])({url:"/roadProducts/attchManager/list",method:"post",data:e})}function l(e){return Object(i["a"])({url:"/roadProducts/attchManager/remove/".concat(e),method:"DELETE",data:e})}function n(e){return Object(i["a"])({url:"/roadProducts/attchManager/add",method:"post",data:e})}function o(e){return Object(i["a"])({url:"/roadProducts/attchManager/edit",method:"put",data:e})}},2:function(e,t){},3:function(e,t){},4:function(e,t){},"4cf9":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"params"},[a("el-form",{ref:"ruleForm",attrs:{inline:!0,model:e.formInline}},[a("el-form-item",{attrs:{label:"文档标题",prop:"fileName"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:e.formInline.fileName,callback:function(t){e.$set(e.formInline,"fileName",t)},expression:"formInline.fileName"}})],1),a("el-form-item",[a("el-form-item",{attrs:{label:"分类",prop:"attchType"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.formInline.attchType,callback:function(t){e.$set(e.formInline,"attchType",t)},expression:"formInline.attchType"}},e._l(e.typeList,(function(e){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:3!=e.dictValue,expression:"item.dictValue != 3"}],key:e.dictValue,attrs:{label:e.dictLabel,value:e.dictValue}})})),1)],1),a("el-button",{attrs:{type:"primary"},on:{click:e.getData}},[e._v("查询")])],1),a("el-form-item",[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["roadProducts:attchManager:add"],expression:"['roadProducts:attchManager:add']"}],attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("新增")])],1)],1)],1),a("div",[a("vxe-grid",{attrs:{"highlight-hover-row":"",stripe:"",resizable:"","auto-resize":"","max-height":"760",border:"",loading:e.table.loading,columns:e.columns,data:e.table.datas,"pager-config":e.table.page},on:{"page-change":e.handlePageChange},scopedSlots:e._u([e.isTop?{key:"isTop",fn:function(t){var i=t.row;return[a("el-switch",{attrs:{"active-text":"1"==i.isTop?"是":"否","active-value":"1","inactive-value":"0"},on:{change:function(t){return e.topChange(t,i)}},model:{value:i.isTop,callback:function(t){e.$set(i,"isTop",t)},expression:"row.isTop"}})]}}:null,{key:"option",fn:function(t){var i=t.row;return[a("el-row",[a("el-col",{attrs:{span:8}},[["docx","doc","pdf","xlsx"].includes(i.fileUrl&&i.fileUrl.split(".")[1])?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handlePreview(i)}}},[e._v(" 查看 ")]):e._e()],1),a("el-col",{attrs:{span:8}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleDownLoad(i)}}},[e._v(" 下载 ")])],1),a("el-col",{attrs:{span:8}},[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["roadProducts:attchManager:remove"],expression:"['roadProducts:attchManager:remove']"}],attrs:{type:"primary"},on:{click:function(t){return e.handleDel(i.id)}}},[e._v("删除")])],1)],1)]}},{key:"top",fn:function(e){e.row}}],null,!0)})],1),a("el-dialog",{attrs:{title:"新增",visible:e.dialogVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",[a("el-form",{ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[a("el-form-item",{attrs:{label:"分类",prop:"attchType"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.attchType,callback:function(t){e.$set(e.form,"attchType",t)},expression:"form.attchType"}},e._l(e.typeList,(function(e){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:3!=e.dictValue,expression:"item.dictValue != 3"}],key:e.dictValue,attrs:{label:e.dictLabel,value:e.dictValue}})})),1)],1),a("el-form-item",{attrs:{label:"文件",prop:"files"}},[a("upload-file",{attrs:{keyId:"files",filesList:e.form.files},on:{returnRes:e._returnRes,returnResDel:e._returnResDel}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("确 定")])],1)]),a("el-dialog",{attrs:{title:e.fileName,visible:e.perviewFile,width:"50vw"},on:{"update:visible":function(t){e.perviewFile=t}}},[a("div",{staticStyle:{"text-align":"center","margin-bottom":"10px"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleDownLoad({relationId:e.relationId,fileName:e.fileName})}}},[e._v(" 下载 ")]),"pdf"==e.fileUrl.split(".")[1]?a("el-button",{attrs:{type:"primary"},on:{click:e.pdfPrintAll}},[e._v(" 打印 ")]):a("el-button",{directives:[{name:"print",rawName:"v-print",value:e.print,expression:"print"}],attrs:{type:"primary"}},[e._v(" 打印 ")]),"pdf"==e.fileUrl.split(".")[1]?a("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-left",size:"mini"},on:{click:e.prePage}},[e._v("上一页")]):e._e(),"pdf"==e.fileUrl.split(".")[1]?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.nextPage}},[e._v("下一页"),a("i",{staticClass:"el-icon-arrow-right el-icon--right"})]):e._e(),"pdf"==e.fileUrl.split(".")[1]?a("el-button",{staticClass:"mr10",attrs:{type:"primary"},on:{click:function(t){return t.stopPropagation(),e.clock(t)}}},[e._v(" 顺时针")]):e._e(),"pdf"==e.fileUrl.split(".")[1]?a("el-button",{staticClass:"mr10",attrs:{type:"primary"},on:{click:function(t){return t.stopPropagation(),e.counterClock(t)}}},[e._v(" 逆时针")]):e._e(),"pdf"==e.fileUrl.split(".")[1]?a("el-button",{attrs:{type:"primary"},on:{click:e.zoomIn}},[e._v("放大")]):e._e(),"pdf"==e.fileUrl.split(".")[1]?a("el-button",{attrs:{type:"primary"},on:{click:e.zoomOut}},[e._v("缩小")]):e._e(),"pdf"==e.fileUrl.split(".")[1]?a("div",{staticStyle:{"margin-top":"10px",color:"#409EFF"}},[e._v(e._s(e.pageNum)+" / "+e._s(e.pageTotalNum)+" ")]):e._e()],1),a("div",{ref:"scrollContainer",style:{height:"70vh",overflow:"auto"},on:{scroll:e.handleScroll}},[["docx","doc"].includes(e.fileUrl.split(".")[1])?a("vue-office-docx",{ref:"wordContent",staticStyle:{height:"auto"},attrs:{id:"print-hz",src:e.fileUrl}}):e._e(),"xlsx"==e.fileUrl.split(".")[1]?a("vue-office-excel",{staticStyle:{height:"100%"},attrs:{id:"print-hz",src:e.fileUrl}}):e._e(),"pdf"==e.fileUrl.split(".")[1]?a("pdf",{ref:"pdf",style:{transform:"scale("+e.pdfscale+")"},attrs:{id:"print-hz",page:e.pageNum,rotate:e.pageRotate,src:e.fileUrl},on:{"num-pages":function(t){e.pageTotalNum=t}}}):e._e()],1)])],1)},r=[],l=a("5530"),n=a("c7eb"),o=a("1da1"),s=(a("caad"),a("14d9"),a("a434"),a("2532"),a("0ddc")),c=a("2934"),u=a("4a77"),f=a("2d46"),p=a.n(f),d=(a("d457"),a("b690")),m=a.n(d),h=(a("2c3a"),a("858e")),g={components:{uploadFile:u["default"],VueOfficeDocx:p.a,VueOfficeExcel:m.a,pdf:h["a"]},data:function(){return{isTop:!1,print:{id:"print-hz"},pdfscale:1,pageNum:1,pageTotalNum:1,pageRotate:0,perviewFile:!1,relationId:"",fileName:"",fileUrl:"",form:{attchType:"",modelName:"bzwd",files:[],model:null},rules:{attchType:[{required:!0,message:"请选择",trigger:"change"}],model:[{required:!0,message:"请选择",trigger:"change"}],files:[{type:"array",required:!0,message:"请选择",trigger:"change"}]},dialogVisible:!1,formInline:{modelName:"bzwd",fileName:""},modelList:[{label:"路产赔补偿",value:"lwxc"},{label:"清障救援",value:"qzjy"}],typeList:[],attchModelNameList:[],table:{loading:!1,page:{total:0,currentPage:1,pageSize:10,align:"right",pageSizes:[10,20,50],layouts:["Sizes","PrevJump","PrevPage","Number","NextPage","NextJump","FullJump","Total"],perfect:!0},datas:[]},columns:[{type:"seq",title:"序号",align:"center",width:100},{title:"文件名称",field:"fileName",align:"center"},{title:"发布人",field:"createBy",align:"center",width:100},{title:"分类",field:"attchTypeName",align:"center",width:150},{title:"发布时间",field:"createTime",align:"center"},{title:"操作",slots:{default:"option"},align:"center",width:"250"}],modelNameList:["lwxc","qzjy","lcpbc","slsg"]}},watch:{"form.files":{handler:function(e){e.length>0&&this.$refs.form.validateField("files")},deep:!0}},mounted:function(){this.getData(),this.getTypeList(),(this.$store.state.user.roles.includes("admin")||this.$store.state.user.permissions.includes("add:btn"))&&(this.isTop=!0,this.columns=[{type:"seq",title:"序号",align:"center",width:100},{title:"文件名称",field:"fileName",align:"left",headerAlign:"center"},{title:"发布人",field:"createBy",align:"center",width:100},{title:"分类",field:"attchTypeName",align:"center",width:150},{title:"发布时间",field:"createTime",align:"center"},{title:"是否置顶",slots:{default:"isTop"},align:"center",width:"150"},{title:"操作",slots:{default:"option"},align:"center",width:"250"}])},methods:{topChange:function(e,t){var a=this;Object(s["b"])({id:t.id,isTop:e}).then((function(e){200==e.code&&(a.getData(),a.$message({type:"success",message:"修改成功"}))}))},handleScroll:function(e){if("pdf"==this.fileUrl.split(".")[1]){if(0===e.target.scrollTop&&this.pageNum>1){this.pageNum=this.pageNum-1;var t=this.$refs.scrollContainer;t.scrollTo(0,50)}if(!(this.pageNum>=this.pageTotalNum)){var a=Math.abs(e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight)<=1;if(a){this.pageNum=this.pageNum+1;var i=this.$refs.scrollContainer;i.scrollTo(0,50)}}}},pdfPrintAll:function(){var e=this;"pdf"==this.fileUrl.split(".")[1]&&this.$nextTick((function(){e.$refs.pdf.print()}))},zoomIn:function(){this.pdfscale>1.7||(this.pdfscale+=.1)},zoomOut:function(){this.pdfscale<.7||(this.pdfscale-=.1)},clock:function(){this.pageRotate+=90},counterClock:function(){this.pageRotate-=90},prePage:function(){var e=this.pageNum;e=e>1?e-1:this.pageTotalNum,this.pageNum=e},nextPage:function(){var e=this.pageNum;e=e<this.pageTotalNum?e+1:1,this.pageNum=e},handlePreview:function(e){this.pdfscale=1,this.fileUrl="/prod-api"+e.fileUrl,this.perviewFile=!0,this.fileName=e.fileName,this.relationId=e.relationId,this.pageNum=1},submitForm:function(e){var t=this;this.$refs[e].validate(function(){var a=Object(o["a"])(Object(n["a"])().mark((function a(i){var r;return Object(n["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!i){a.next=10;break}return r={relationId:t.form.files[0].id,fileName:t.form.files[0].fileName,fileUrl:t.form.files[0].fileUrl,attchType:t.form.attchType,model:t.form.model,modelName:"bzwd"},a.next=4,Object(s["a"])(r);case 4:t.$message.success("上传成功"),t.dialogVisible=!1,t.$refs[e].resetFields(),t.getData(),a.next=11;break;case 10:return a.abrupt("return",!1);case 11:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},resetForm:function(e){this.dialogVisible=!1,this.$refs[e].resetFields()},_returnRes:function(e){var t={fileName:e.fileName,fileUrl:e.fileUrl,id:e.id,name:e.fileName,status:"success",uid:e.uid,url:"/prod-api"+e.fileUrl,response:{data:{fileUrl:e.fileUrl,id:e.id,name:e.fileName,status:"success",uid:e.uid,url:"/prod-api"+e.fileUrl}}};this.form.files.push(t)},_returnResDel:function(e){for(var t=this.form.files,a=0;a<t.length;a++)if(t[a].id==e.id){this.form.files.splice(a,1);break}},handleDel:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(Object(n["a"])().mark((function a(){return Object(n["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(s["d"])(e);case 2:t.$message({type:"success",message:"删除成功!"}),t.getData();case 4:case"end":return a.stop()}}),a)})))).catch((function(){}))},handleDownLoad:function(e){var t=this;this.$confirm("是否下载文件?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(Object(n["a"])().mark((function a(){return Object(n["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.downloadGet("/roadProducts/attach/download/".concat(e.relationId),e.fileName);case 2:case"end":return a.stop()}}),a)})))).catch((function(){}))},getTypeList:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["k"])({dictType:"standardization_attch_type"});case 2:a=t.sent,e.typeList=a.rows;case 4:case"end":return t.stop()}}),t)})))()},handlePageChange:function(e){var t=e.currentPage,a=e.pageSize;this.table.page.currentPage=t,this.table.page.pageSize=a,this.getData()},getData:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a,i;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.table.loading=!0,a=Object(l["a"])(Object(l["a"])({},e.formInline),{},{pageNum:e.table.page.currentPage,pageSize:e.table.page.pageSize,attchType:"1,2,4,6"}),t.next=4,Object(s["c"])(a);case 4:i=t.sent,e.table.datas=i.rows,e.table.page.total=i.total,e.table.loading=!1;case 8:case"end":return t.stop()}}),t)})))()}}},b=g,v=(a("c124"),a("2877")),y=Object(v["a"])(b,i,r,!1,null,"3bbc64cc",null);t["default"]=y.exports},5:function(e,t){},6:function(e,t){},7:function(e,t){},"837f":function(e,t,a){},c124:function(e,t,a){"use strict";a("837f")}}]);