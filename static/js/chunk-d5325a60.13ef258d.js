(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d5325a60","chunk-d5325a60"],{"0873":function(e,r,n){"use strict";n.r(r);var t=function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"pjfyj_comp"},[n("section",{staticClass:"section_card"},[n("div",{staticClass:"title"},[n("span",[e._v("当事人证件信息")]),n("div",{staticClass:"add_table",on:{click:e.innersAdd}},[e._v("添加")])]),n("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},e._l(e.ruleForm.inners,(function(r,t){return n("div",{key:r.id,staticClass:"card"},[0!=t?n("div",{staticClass:"del_btn",on:{click:function(n){return e.innersDel(r.id)}}},[e._v(" x ")]):e._e(),n("el-row",[n("el-col",{attrs:{span:8}},[n("el-form-item",{attrs:{label:"当事人姓名",prop:"inners."+t+".dsr.name",rules:[{required:!0,message:"姓名不能为空",trigger:"blur"}]}},[n("el-input",{attrs:{placeholder:"请输入"},model:{value:r.dsr.name,callback:function(n){e.$set(r.dsr,"name",n)},expression:"item.dsr.name"}})],1)],1),n("el-col",{attrs:{span:8}},[n("el-form-item",{attrs:{label:"车牌号",prop:"inners."+t+".dsr.carPlate",rules:[{required:!0,message:"车牌号不能为空",trigger:"blur"}]}},[n("el-input",{attrs:{placeholder:"请输入"},model:{value:r.dsr.carPlate,callback:function(n){e.$set(r.dsr,"carPlate",n)},expression:"item.dsr.carPlate"}})],1)],1)],1),n("el-row",[n("el-form-item",{attrs:{label:"票据复印件",prop:"inners."+t+".dsr.name",rules:[{required:!0,message:"姓名不能为空",trigger:"blur"}]}},[n("upload",{attrs:{filesList:r.images2,Index:t,isChange:!0,objParams:{newStyle:!0}},on:{returnRes:e.uploadImg,returnResDel:e.removeImg}})],1)],1)],1)})),0)],1),n("section",{staticStyle:{display:"flex","justify-content":"center",padding:"25px 0"}},[n("el-button",{on:{click:function(r){return e.$emit("close")}}},[e._v("关闭")]),n("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.submitForm("ruleForm")}}},[e._v("确定")])],1)])},i=[],s=n("c7eb"),a=n("1da1"),o=(n("4de4"),n("d81d"),n("14d9"),n("e9c4"),n("b64b"),n("d3b7"),n("36fa")),l=n("e95a7"),u={components:{upload:o["a"]},props:{close:{type:Function,require:!0},show:{type:Boolean}},watch:{show:{handler:function(e,r){e?!this.loading&&this.getData():this.ruleForm={}},deep:!0}},data:function(){return{ruleForm:{},innersObj:{dsr:{name:void 0,carPlate:void 0},images:[],images2:[]},rules:{},loading:!0,imgUrl:"/prod-api"}},mounted:function(){this.getData()},methods:{submitForm:function(e){var r=this;this.$refs[e].validate(function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(n){var t,i;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n&&(r.loading=!0,t=JSON.parse(JSON.stringify(r.ruleForm)),t.inners.map((function(e){delete e.images2})),i={inners:t.inners},Object(l["b"])({pjfyj:i},{businessId:r.$route.query.id,docCode:"new_pjfyj"}).then((function(e){200==e.code&&(r.loading=!1,r.$message.success("保存成功"),r.$emit("close"))})));case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())},innersDel:function(e){this.ruleForm.inners=this.ruleForm.inners.filter((function(r){return r.id!=e}))},innersAdd:function(){var e={dsr:{name:void 0,carPlate:void 0},images:[],images2:[],id:10*Math.random()*this.ruleForm.inners.length};this.ruleForm.inners.push(e)},uploadImg:function(e){var r={path:e.fileUrl,id:e.id,src:this.imgUrl+e.fileUrl};this.ruleForm.inners[e.Index].images.push(r)},removeImg:function(e){e.id=e.id||e.response&&e.response.data.id,this.ruleForm.inners[e.Index].images=this.ruleForm.inners[e.Index].images.filter((function(r){return r.id!=e.id}))},processingImg:function(e){var r=this,n=JSON.parse(JSON.stringify(e));return n.map((function(e){e.url=r.imgUrl+e.path})),n},getData:function(){var e=this;return Object(a["a"])(Object(s["a"])().mark((function r(){return Object(s["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.loading=!0,r.next=3,Object(l["a"])({businessId:e.$route.query.id,docCode:"new_pjfyj"}).then((function(r){var n={inners:[]};if(e.ruleForm=r.data.pjfyj||n,e.ruleForm.inners.length>0)e.ruleForm.inners.map((function(r){r.dsr=r.dsr||{},r.images=r.images||[],r.images2=e.processingImg(r.images)}));else{var t,i={dsr:{},images:[],images2:[]};e.ruleForm.inners.push(i),null===(t=r.data.baseData)||void 0===t||null===(t=t.dsrList)||void 0===t||t.map((function(r,n){e.ruleForm.inners[n].dsr=r}))}e.ruleForm.inners.map((function(e,r){e.id=10*Math.random()*r})),e.loading=!1}));case 3:case"end":return r.stop()}}),r)})))()}}},c=u,d=(n("70f5"),n("2877")),m=Object(d["a"])(c,t,i,!1,null,"ae52e94e",null);r["default"]=m.exports},"70f5":function(e,r,n){"use strict";n("d681")},d681:function(e,r,n){},e95a7:function(e,r,n){"use strict";n.d(r,"a",(function(){return i})),n.d(r,"b",(function(){return s}));n("99af");var t=n("b775");function i(e){var r=e.businessId,n=e.docCode;return Object(t["a"])({url:"/roadProducts/roadDoc/docDetails/".concat(r,"/").concat(n),method:"get"})}function s(e,r){var n=r.businessId,i=r.docCode;return Object(t["a"])({url:"/roadProducts/roadDoc/saveDoc/".concat(n,"/").concat(i),method:"post",data:e})}}}]);