(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0b9924d3"],{"690c":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-dialog",{attrs:{title:"附属设施",visible:e.isShow,isShow:e.show,"append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.isShow=t},close:function(t){e.$emit("update:show",!1)}}},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px",disabled:!e.isBtn}},[r("div",{staticClass:"card"},[r("div",{staticClass:"title"},[e._v(" 基本信息 ")]),r("div",{staticClass:"content"},[r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"设施名称：",prop:"facilityName"}},[r("el-input",{attrs:{placeholder:"输入名称"},model:{value:e.ruleForm.facilityName,callback:function(t){e.$set(e.ruleForm,"facilityName",t)},expression:"ruleForm.facilityName"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"单位名称：",prop:"companyId"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:e.setZDID},model:{value:e.ruleForm.companyId,callback:function(t){e.$set(e.ruleForm,"companyId",t)},expression:"ruleForm.companyId"}},e._l(e.depList,(function(e){return r("el-option",{key:e.deptId,attrs:{label:e.deptName,value:e.deptId}})})),1)],1)],1),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"建档部门：",prop:"orgId"}},[r("el-cascader",{key:e.cascaderKey,ref:"ancillaryFacilitiesCascader",attrs:{"popper-class":"cascader",options:e.DWList,props:{value:"id",checkStrictly:!0,emitPath:!1},"expand-trigger":"hover"},on:{change:e.handleChange},model:{value:e.ruleForm.orgId,callback:function(t){e.$set(e.ruleForm,"orgId",t)},expression:"ruleForm.orgId"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"路段名称"}},[r("el-select",{attrs:{clearable:"",placeholder:"选择路段"},on:{change:e.ldSelect},model:{value:e.ruleForm.roadId,callback:function(t){e.$set(e.ruleForm,"roadId",t)},expression:"ruleForm.roadId"}},e._l(e.roadList,(function(e,t){return r("el-option",{key:e.id+t,attrs:{label:e.roadDesc,value:e.id}})})),1)],1)],1),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"路段编码："}},[r("el-input",{attrs:{disabled:"",placeholder:"输入路段编码"},model:{value:e.ruleForm.roadCode,callback:function(t){e.$set(e.ruleForm,"roadCode",t)},expression:"ruleForm.roadCode"}})],1)],1)],1)],1)]),r("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[r("div",{staticClass:"card"},[r("div",{staticClass:"title"},[e._v(" 设施信息 ")]),r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"路产内容：",prop:"facilityDesc "}},[r("el-input",{attrs:{placeholder:"输入路产内容"},model:{value:e.ruleForm.facilityDesc,callback:function(t){e.$set(e.ruleForm,"facilityDesc",t)},expression:"ruleForm.facilityDesc"}})],1)],1),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"建立时间：",prop:"buildDate"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"请选择日期","value-format":"yyyy-MM-dd"},model:{value:e.ruleForm.buildDate,callback:function(t){e.$set(e.ruleForm,"buildDate",t)},expression:"ruleForm.buildDate"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"起点桩号：",prop:"startLineKmLevel"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{placeholder:"请输入",oninput:"value=value.replace(/[^0-9]/g,'')"},model:{value:e.ruleForm.startLineKmLevel,callback:function(t){e.$set(e.ruleForm,"startLineKmLevel",t)},expression:"ruleForm.startLineKmLevel"}},[r("template",{slot:"prepend"},[e._v("k")])],2)],1),r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{placeholder:"请输入",oninput:"value=value.replace(/[^0-9]/g,'')"},model:{value:e.ruleForm.startLineMLevel,callback:function(t){e.$set(e.ruleForm,"startLineMLevel",t)},expression:"ruleForm.startLineMLevel"}},[r("template",{slot:"prepend"},[e._v("+")])],2)],1)],1)],1)],1),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"终点桩号：",prop:"endLineKmLevel"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{placeholder:"请输入",oninput:"value=value.replace(/[^0-9]/g,'')"},model:{value:e.ruleForm.endLineKmLevel,callback:function(t){e.$set(e.ruleForm,"endLineKmLevel",t)},expression:"ruleForm.endLineKmLevel"}},[r("template",{slot:"prepend"},[e._v("k")])],2)],1),r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{placeholder:"请输入",oninput:"value=value.replace(/[^0-9]/g,'')"},model:{value:e.ruleForm.endLineMLevel,callback:function(t){e.$set(e.ruleForm,"endLineMLevel",t)},expression:"ruleForm.endLineMLevel"}},[r("template",{slot:"prepend"},[e._v("+")])],2)],1)],1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"中心桩号：",prop:"startLineKmLevel"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{placeholder:"请输入",oninput:"value=value.replace(/[^0-9]/g,'')"},model:{value:e.ruleForm.lineKmLevel,callback:function(t){e.$set(e.ruleForm,"lineKmLevel",t)},expression:"ruleForm.lineKmLevel"}},[r("template",{slot:"prepend"},[e._v("k")])],2)],1),r("el-col",{attrs:{span:12}},[r("el-input",{attrs:{placeholder:"请输入",oninput:"value=value.replace(/[^0-9]/g,'')"},model:{value:e.ruleForm.lineMLevel,callback:function(t){e.$set(e.ruleForm,"lineMLevel",t)},expression:"ruleForm.lineMLevel"}},[r("template",{slot:"prepend"},[e._v("+")])],2)],1)],1)],1)],1),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"面板尺寸：",prop:"panelSize"}},[r("el-input",{attrs:{placeholder:"请输入"},model:{value:e.ruleForm.panelSize,callback:function(t){e.$set(e.ruleForm,"panelSize",t)},expression:"ruleForm.panelSize"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"路产数量：",prop:"quantity"}},[r("el-input",{attrs:{placeholder:"请输入"},model:{value:e.ruleForm.quantity,callback:function(t){e.$set(e.ruleForm,"quantity",t)},expression:"ruleForm.quantity"}})],1)],1),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"设施状况：",prop:"status"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},e._l(e.status,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"所在辖区：",prop:"location"}},[r("el-input",{attrs:{placeholder:"请输入"},model:{value:e.ruleForm.location,callback:function(t){e.$set(e.ruleForm,"location",t)},expression:"ruleForm.location"}})],1)],1)],1),e._e()],1),r("div",{staticClass:"card"},[r("div",{staticClass:"title"},[e._v(" 设施照片 ")]),r("el-collapse-item",{attrs:{title:"",name:"3"}},[r("el-row",[r("el-form-item",{attrs:{label:"设施照片：",prop:"pic"}},[r("upload",{attrs:{objParams:{newStyle:!0},filesList:e.filesList},on:{returnRes:e._returnRes,returnResDel:e._returnResDel},model:{value:e.ruleForm.pic,callback:function(t){e.$set(e.ruleForm,"pic",t)},expression:"ruleForm.pic"}})],1)],1),r("el-row",[r("el-form-item",{attrs:{label:"拍摄时间：",prop:"picTime"}},[(Number(e.ruleForm.relationId),r("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择日期","value-format":"yyyy-MM-dd hh:mm"},model:{value:e.ruleForm.picTime,callback:function(t){e.$set(e.ruleForm,"picTime",t)},expression:"ruleForm.picTime"}}))],1)],1),r("el-row",[r("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],1)],1)],1)]),e.isBtn?r("el-form-item",{staticStyle:{"margin-top":"40px"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("立即创建")]),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1):e._e()],1)],1)],1)},l=[],s=r("5530"),i=r("c7eb"),n=r("1da1"),o=(r("4de4"),r("a15b"),r("d81d"),r("14d9"),r("b0c0"),r("d3b7"),r("2934")),c=r("a700"),u=r("36fa"),m={components:{upload:u["a"]},props:{show:{type:Boolean,default:!1},search:{type:Object,default:function(){return{}}}},watch:{show:function(e){this.isShow=e,e||this.resetForm("ruleForm")},search:{handler:function(e,t){this.ruleForm.relationId=e.relationId},immediate:!0}},data:function(){return{isShowInformation:!0,XLList:[],cascaderKey:0,isBtn:!0,isShowLoading:!1,isShow:this.show,reqUrl:"add",stateList:[],depList:[],DWList:[],roadList:[],upAndDownList:[],activeNames:["1","2","3"],ruleForm:{relationId:"",orgId:"",orgDesc:"",companyId:"",companyDesc:"",roadId:"",roadCode:"",roadDesc:"",technicalLevel:"",rampDir:"",rampName:"",remark:"",directionId:"",labelTypeId:"",installationClassId:"118",labelCode:"",nearPickTime:"",installationPickTime:"",nearPic:"",farPickTime:"",setDesc:"",controlDesc:"",buildDate:"",installationPic:"",farPic:"",picPickTime:"",buildDesc:"",panelSize:"",holdForm:"",columnSize:"",bridgeTunnelDesc:"",installationLocation:"",startLineKmLevel:"",startLineMLevel:"",endLineKmLevel:"",endLineMLevel:"",lineKmLevel:"",lineMLevel:"",numCnt:"",installationCategory:"",entryName:"",facilityName:"",roadPropertyNumber:"",quantity:"",location:"",facilityDesc:"",status:"",pic:"",picTime:""},status:[{label:"在用",value:1},{label:"废弃",value:0},{label:"停用",value:2}],ssTypeList:[],sswzList:[],bzTypeList:[],filesList:[],imgsList:[],filesList1:[],imgsList1:[],typeList:[{label:"防护设备",value:"118"},{label:"排水设施",value:"119"},{label:"交通安全设施",value:"120"},{label:"监控设施",value:"121"},{label:"标志",value:"122"}],rules:{roadId:[{required:!0,message:"请选择",trigger:"change"}],installationLocation:[{required:!0,message:"请选择",trigger:"change"}],companyId:[{required:!0,message:"请选择",trigger:"change"}],orgId:[{required:!0,message:"请选择",trigger:"change"}],nearPic:[{required:!0,message:"请选择",trigger:"change"}],farPic:[{required:!0,message:"请选择",trigger:"change"}],installationPic:[{required:!0,message:"请选择",trigger:"change"}],technicalLevel:[{required:!0,message:"请选择",trigger:"change"}],roadCode:[{required:!0,message:"请选择",trigger:"change"}],roadDesc:[{required:!0,message:"请选择",trigger:"change"}],directionId:[{required:!0,message:"请选择",trigger:"change"}],numCnt:[{required:!0,message:"请输入",trigger:"blur"}]}}},created:function(){this.INITDATA(),this.getData(),this.getstateList()},methods:{ldSelect:function(e){var t=this;this.roadList.map((function(r){r.id==e&&(t.ruleForm.roadCode=r.roadCode,t.ruleForm.roadDesc=r.roadDesc)}))},orgHandleChange:function(e){var t=this;return Object(n["a"])(Object(i["a"])().mark((function r(){var a,l;return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return");case 2:return t.ruleForm.orgId=e[e.length-1],a={orgId:t.ruleForm.orgId,pageNum:1,pageSize:99},t.ruleForm.roadDesc="",r.next=7,Object(c["R"])(a);case 7:l=r.sent,t.XLList=l.rows;case 9:case"end":return r.stop()}}),r)})))()},setRelationId:function(e){this.ruleForm.relationId=e,this.ruleForm.installationClassId=e},_returnRes:function(e){var t={name:e.fileName,attachId:e.id,fileUrl:e.fileUrl};this.imgsList.push(t)},_returnResDel:function(e){this.imgsList=this.imgsList.filter((function(t){return t.attachId!=e.id}))},_returnRes1:function(e){var t={name:e.fileName,attachId:e.id,fileUrl:e.fileUrl};this.imgsList1.push(t)},_returnResDel1:function(e){this.imgsList1=[]},getstateList:function(){return Object(n["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},setInitPage:function(e){for(var t=0;t<this.roadList.length;t++)if(this.roadList[t].id==e){this.ruleForm.roadCode=this.roadList[t].roadCode,this.ruleForm.technicalLevel=this.roadList[t].technicalLevel;break}},getData:function(){var e=this;return Object(n["a"])(Object(i["a"])().mark((function t(){var r,a,l,n,u,m,d;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$store.getters.userInfo,"",a="",r.admin||(r.gly?r.companyId:a=r.orgId),l={orgId:a},n=Object(s["a"])(Object(s["a"])({},l),{},{pageNum:1,pageSize:99}),t.next=7,Object(c["J"])(n);case 7:return u=t.sent,e.roadList=u.rows,t.next=11,Object(o["j"])();case 11:return m=t.sent,e.depList=m.data,t.next=15,Object(o["g"])({ancestors:e.$store.getters.userInfo.companyId,isFilter:!0});case 15:if(d=t.sent,e.cascaderKey++,e.DWList=d.data,e.$store.getters.userInfo.roles.map((function(t){("jtld"==t.roleKey||t.admin)&&(e.isShowInformation=!1)})),e.isShowInformation){t.next=21;break}return t.abrupt("return");case 21:e.ruleForm.companyDesc=e.$store.getters.userInfo.companyName,e.ruleForm.companyId=e.$store.getters.userInfo.companyId,e.ruleForm.orgId=e.$store.getters.userInfo.dept.deptId,e.ruleForm.orgDesc=e.$store.getters.userInfo.dept.deptName;case 25:case"end":return t.stop()}}),t)})))()},checkLineLevel:function(){var e=this.ruleForm;if(e.startLineKmLevel||e.startLineMLevel){var t=!1;if(e.startLineKmLevel&&e.startLineMLevel&&(t=!0),!t)return this.$message({message:"请填写完整的起点桩号",type:"warning"}),t}if(e.endLineKmLevel||e.endLineMLevel){var r=!1;if(e.endLineKmLevel&&e.endLineMLevel&&(r=!0),!r)return this.$message({message:"请填写完整的终点桩号",type:"warning"}),r}if(e.lineKmLevel||e.lineMLevel){var a=!1;if(e.lineKmLevel&&e.lineMLevel&&(a=!0),!a)return this.$message({message:"请填写完整的中点桩号",type:"warning"}),a}return!0},submitForm:function(e){var t=this,r="add"==this.reqUrl?"post":"put";0!=this.imgsList.length?this.ruleForm.pic=this.imgsList.map((function(e){return e.attachId})).join(","):this.ruleForm.pic="",0!=this.imgsList1.length&&(this.ruleForm.nearPic=this.imgsList1[0].fileUrl);var a=this.checkLineLevel();a&&this.$refs[e].validate((function(e){if(!e)return!1;t.isShowLoading||(t.isShowLoading=!0,Object(c["j"])(t.ruleForm,t.reqUrl,r).then((function(e){200==e.code&&(t.$message({message:"成功!",type:"success"}),t.$emit("notice"),t.isShowLoading=!1,t.resetForm("ruleForm"),t.isShow=!1)})).catch((function(e){t.isShowLoading=!1})))}))},resetForm:function(e){this.ruleForm={relationId:"",orgId:"",orgDesc:"",companyId:"",companyDesc:"",roadId:"",roadCode:"",roadDesc:"",technicalLevel:"",rampDir:"",rampName:"",remark:"",directionId:"",labelTypeId:"",installationClassId:"118",labelCode:"",nearPickTime:"",installationPickTime:"",nearPic:"",farPickTime:"",setDesc:"",controlDesc:"",buildDate:"",installationPic:"",farPic:"",picPickTime:"",buildDesc:"",panelSize:"",holdForm:"",columnSize:"",bridgeTunnelDesc:"",installationLocation:"",startLineKmLevel:"",startLineMLevel:"",endLineKmLevel:"",endLineMLevel:"",lineKmLevel:"",lineMLevel:"",numCnt:"",installationCategory:"",entryName:"",facilityName:"",roadPropertyNumber:"",quantity:"",location:"",facilityDesc:"",status:"",pic:"",picTime:""},this.filesList=[],this.imgsList=[],this.filesList1=[],this.imgsList1=[],this.$refs[e].resetFields(),this.cascaderKey=0,this.isShowInformation&&(this.ruleForm.companyDesc=this.$store.getters.userInfo.companyName,this.ruleForm.companyId=this.$store.getters.userInfo.companyId,this.ruleForm.orgId=this.$store.getters.userInfo.dept.deptId,this.ruleForm.orgDesc=this.$store.getters.userInfo.dept.deptName)},setIsShowBtn:function(e){this.isBtn=e},setUrl:function(e){this.reqUrl=e},getInfo:function(e){var t=this;return Object(n["a"])(Object(i["a"])().mark((function r(){var a,l;return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.isShow=!0,r.next=3,Object(c["l"])(e);case 3:a=r.sent,t.setZDID(a.data.companyId),t.ruleForm=a.data,l=a.data,l.picList&&(t.filesList=l.picList.map((function(e){var r={response:{data:{}}},a={};return r.name=e.fileName,r.fileName=e.fileName,r.id=e.id,r.fileUrl=e.fileUrl,r.url="/prod-api"+e.fileUrl,r.response.data.name=e.fileName,r.response.data.fileName=e.fileName,r.response.data.id=e.id,r.response.data.fileUrl=e.fileUrl,r.response.data.url="/prod-api"+e.fileUrl,a.name=e.fileName,a.attachId=e.id,a.fileUrl=e.fileUrl,t.imgsList.push(a),r})));case 8:case"end":return r.stop()}}),r)})))()},handleChange:function(e){var t=this;return Object(n["a"])(Object(i["a"])().mark((function e(){var r;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$refs.ancillaryFacilitiesCascader&&(t.ruleForm.orgDesc=null===(r=t.$refs.ancillaryFacilitiesCascader.getCheckedNodes()[0])||void 0===r?void 0:r.data.label,t.$refs.ancillaryFacilitiesCascader.dropDownVisible=!1);case 1:case"end":return e.stop()}}),e)})))()},setZDID:function(e){var t=this;return Object(n["a"])(Object(i["a"])().mark((function r(){var a,l,s;return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.DWList=[],t.ruleForm.orgId=void 0,t.ruleForm.orgDesc=void 0,t.ruleForm.companyDesc=t.depList.filter((function(t){return t.deptId==e}))[0].deptName,t.cascaderKey=0,r.next=7,Object(o["g"])({ancestors:e,isFilter:!0});case 7:return a=r.sent,t.DWList=a.data,l={pageNum:1,pageSize:99,companyId:e},r.next=12,Object(c["J"])(l);case 12:s=r.sent,t.roadList=s.rows;case 14:case"end":return r.stop()}}),r)})))()},INITDATA:function(){var e=this;return Object(n["a"])(Object(i["a"])().mark((function t(){var r,a,l,s,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(o["k"])({dictType:"tunnel_direction"});case 2:return r=t.sent,e.upAndDownList=r.rows,t.next=6,Object(o["k"])({dictType:"road_main_line_level"});case 6:return a=t.sent,e.stateList=a.rows,t.next=10,Object(o["k"])({dictType:"accessory_ss_type"});case 10:return l=t.sent,e.ssTypeList=l.rows,t.next=14,Object(o["k"])({dictType:"accessory_ss_location"});case 14:return s=t.sent,e.sswzList=s.rows,t.next=18,Object(o["k"])({dictType:"accessory_bz_type"});case 18:n=t.sent,e.bzTypeList=n.rows;case 20:case"end":return t.stop()}}),t)})))()}}},d=m,p=(r("b867"),r("2877")),f=Object(p["a"])(d,a,l,!1,null,"047914e9",null);t["default"]=f.exports},9198:function(e,t,r){},b867:function(e,t,r){"use strict";r("9198")}}]);